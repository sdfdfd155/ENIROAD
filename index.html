<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>카카오맵 길찾기</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c6dcc0c6916ba71802e3393158bab1bd&libraries=services"></script>
    <style>
        #map {
            width: 100%;
            height: 500px;
        }
    </style>
</head>
<body>
    <h1>카카오맵 길찾기</h1>
    <form id="routeForm">
        <label for="start">출발지:</label>
        <input type="text" id="start" name="start" required>
        <label for="end">목적지:</label>
        <input type="text" id="end" name="end" required>
        <button type="submit">길찾기</button>
    </form>
    <div id="map"></div>

    <script>
        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: new kakao.maps.LatLng(37.5665, 126.9780), // 서울시청 좌표
            level: 3 // 지도 확대 레벨
        };

        var map = new kakao.maps.Map(mapContainer, mapOption);

        var ps = new kakao.maps.services.Places(); // 장소 검색 객체 생성
        var directions = new kakao.maps.services.Directions(); // 길찾기 객체 생성

        document.getElementById('routeForm').onsubmit = function(event) {
            event.preventDefault(); // 폼 제출을 막음

            var start = document.getElementById('start').value;
            var end = document.getElementById('end').value;

            if (!start || !end) {
                alert("출발지와 목적지를 모두 입력하세요.");
                return;
            }

            // 출발지와 목적지의 좌표를 검색
            ps.keywordSearch(start, function (startData, status) {
                if (status === kakao.maps.services.Status.OK) {
                    var startCoords = new kakao.maps.LatLng(startData[0].y, startData[0].x);

                    ps.keywordSearch(end, function (endData, status) {
                        if (status === kakao.maps.services.Status.OK) {
                            var endCoords = new kakao.maps.LatLng(endData[0].y, endData[0].x);

                            // 길찾기 요청
                            directions.route({
                                origin: startCoords,
                                destination: endCoords,
                                travelMode: kakao.maps.services.TravelMode.DRIVING
                            }, function (result, status) {
                                if (status === kakao.maps.services.Status.OK) {
                                    // 지도에 경로 표시
                                    var polyline = new kakao.maps.Polyline({
                                        path: result.routes[0].path,
                                        strokeWeight: 5,
                                        strokeColor: '#FF0000',
                                        strokeOpacity: 0.7,
                                        strokeStyle: 'solid'
                                    });
                                    polyline.setMap(map);

                                    // 출발지와 목적지를 포함한 경로 범위로 지도를 재설정
                                    var bounds = new kakao.maps.LatLngBounds();
                                    bounds.extend(startCoords);
                                    bounds.extend(endCoords);
                                    map.setBounds(bounds);
                                } else {
                                    alert("길찾기에 실패했습니다.");
                                }
                            });
                        } else {
                            alert("목적지 검색에 실패했습니다.");
                        }
                    });
                } else {
                    alert("출발지 검색에 실패했습니다.");
                }
            });
        };
    </script>
</body>
</html>
